<!DOCTYPE html>
<html>
  <head>
    <title>D3.JS World Map</title>
    
    <link rel="stylesheet" href="/libs/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/libs/bootstrap/css/bootstrap-theme.min.css">
    <style type="text/css">
      svg {
        border: 1px solid #ddd;
      }
      
      body {
        background: #fcfcfa;
      }
    
      .stroke {
        fill: none;
        stroke: #000;
        stroke-width: 3px;
      }
      
      .fill {
        fill: #fff;
      }
      
      .graticule {
        fill: none;
        stroke: #222;
        stroke-width: .5px;
        stroke-opacity: .5;
      }
      
      .land {
        fill: #222;
      }
      
      .boundary {
        fill: none;
        stroke: #fff;
        stroke-width: .5px;
      }
      
      body {
        overflow: hidden;
      }
      
      #map {
        background-color: #092a51;
      }
    </style>
  </head>
<body>
  <div class="container">
    <h1>World Map</h1>
  </div>
  <div id="map"></div>
  
  <script src="/libs/jquery/jquery.min.js"></script>
  <script src="/libs/d3/d3.min.js"></script>
  <script src="//d3js.org/d3-geo-projection.v1.min.js"></script>
  <script src="/libs/topojson/topojson.min.js"></script>
  <script type="text/javascript">
    var height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
    var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    
    //var projection = d3.geoMercator();
    // var x = d3.scaleLinear()
    // .range([0, width]);

    // var y = d3.scaleLinear()
    //     .range([0, height]);
    
    // var projection = d3.geoTransform({
    //   point: function(px, py) { this.stream.point(x(px), y(py)); }
    // });
    
    var projection = d3.geoCollignon()
    .scale(500)
    .translate([width / 2, height / 2])
    .precision(.1);
    
    var path = d3.geoPath().projection(projection);
    var svg = d3.select("#map")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    //Grid Line
    var graticule = d3.geoGraticule()
      .step([18, 9]);

    svg.append("path")
      .datum(graticule)
      .attr("class", "graticule")
      .attr("d", path);
      
    var mapGroup = svg.append("g");
      
    d3.json('/data/indonesia.json', function(data) {
      console.log(data);
      var states = topojson.feature(data, data.objects.subunits);
      var mapProjection = d3.geoMercator();
      var mapPath = d3.geoPath().projection(mapProjection);
      //Rotate: https://en.wikipedia.org/wiki/Aircraft_principal_axes
      //Yaw - Pitch - Roll
      //projection.scale(1).translate([0, 0]);
      mapProjection.scale(1).translate([0, 0]).rotate([0, 0, 0]);

      var b = mapPath.bounds(states);
      var s = .90 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height);
      var t = [(width - s * (b[1][0] + b[0][0])) / 2, (height - s * (b[1][1] + b[0][1])) / 2];
      
      mapProjection.scale(s).translate(t);
      var map = mapGroup.selectAll('path').data(states.features);
      
      map.enter()
        .append('path')
        .attr('d', mapPath)

      map.exit().remove();
      //console.log(data);
      //Test
      // svg.insert("path", ".graticule")
      // .datum(topojson.feature(data, data.objects.subunits))
      // .attr("class", "land")
      // .attr("d", path);
    });
  </script>
</body>
</html>
